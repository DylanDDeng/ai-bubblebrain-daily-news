name: Auto Sync Daily to Hugo

on:
  push:
    paths:
      - 'daily/*.md'
  workflow_dispatch:

jobs:
  sync-daily:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Sync daily content to Hugo
      run: |
        echo "ğŸ”„ åŒæ­¥æ¯æ—¥å†…å®¹åˆ° Hugo..."
        
        # ç¡®ä¿ç›®å½•å­˜åœ¨
        mkdir -p content/daily
        
        # åŒæ­¥æ‰€æœ‰ daily/*.md æ–‡ä»¶
        for file in daily/*.md; do
          if [ -f "$file" ] && [ "$(basename "$file")" != "SUMMARY.md" ]; then
            filename=$(basename "$file")
            date_str="${filename%.md}"
            
            # æ£€æŸ¥ content/daily ä¸­æ˜¯å¦å·²å­˜åœ¨
            if [ ! -f "content/daily/$filename" ]; then
              echo "ğŸ“„ å¤„ç†: $filename"
              
              # ç”Ÿæˆ Hugo front matter
              cat > "content/daily/$filename" <<EOF
---
title: "AI æ´å¯Ÿæ—¥æŠ¥ - $date_str"
date: ${date_str}T09:00:00+08:00
description: "AI æ´å¯Ÿæ—¥æŠ¥ - $(date -d "$date_str" '+%Yå¹´%mæœˆ%dæ—¥' 2>/dev/null || echo "$date_str")"
categories:
  - æ—¥æŠ¥
tags:
  - AI
  - äººå·¥æ™ºèƒ½
  - è¡Œä¸šåŠ¨æ€
draft: false
---

EOF
              # æ·»åŠ åŸå§‹å†…å®¹
              cat "$file" >> "content/daily/$filename"
              echo "âœ… å·²åŒæ­¥: $filename"
            else
              echo "â­ï¸  è·³è¿‡å·²å­˜åœ¨: $filename"
            fi
          fi
        done

    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
        if [ -n "$(git status --porcelain content/daily/)" ]; then
          git add content/daily/
          git commit -m "Auto sync: åŒæ­¥æ¯æ—¥å†…å®¹åˆ° Hugo [skip ci]"
          git push
          echo "âœ… æ›´æ”¹å·²æ¨é€"
        else
          echo "â„¹ï¸  æ²¡æœ‰éœ€è¦åŒæ­¥çš„å†…å®¹"
        fi