<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šæµ·å¤©é™…çº¿ - ä½“ç´ è‰ºæœ¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(180deg, #0f1419 0%, #1a2a40 30%, #2d4263 60%, #87CEEB 100%);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1200px;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
        }

        /* æ ‡é¢˜æ ·å¼ */
        .header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            z-index: 1000;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
            width: 90%;
        }

        .header h1 {
            font-size: 36px;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-transform: uppercase;
            background: linear-gradient(45deg, #fff, #ffd700, #fff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.9; filter: brightness(1); }
            50% { opacity: 1; filter: brightness(1.2); }
        }

        .header p {
            font-size: 14px;
            opacity: 0.8;
            letter-spacing: 1px;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: absolute;
            bottom: 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 95%;
            z-index: 1000;
        }

        .btn {
            padding: 8px 14px;
            background: rgba(30, 30, 50, 0.85);
            color: #fff;
            border: 2px solid rgba(100, 150, 255, 0.4);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .btn:hover {
            background: rgba(60, 80, 180, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(100, 150, 255, 0.4);
            border-color: rgba(150, 200, 255, 0.8);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.active {
            background: rgba(255, 100, 50, 0.9);
            border-color: rgba(255, 150, 100, 1);
            box-shadow: 0 0 15px rgba(255, 100, 50, 0.5);
        }

        /* åŸå¸‚åœºæ™¯å®¹å™¨ */
        .cityscape {
            position: relative;
            width: 900px;
            height: 600px;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            animation: gentle-float 15s ease-in-out infinite;
        }

        @keyframes gentle-float {
            0%, 100% { transform: translateZ(0) translateY(0); }
            50% { transform: translateZ(20px) translateY(-10px); }
        }

        .cityscape.paused {
            animation: none;
        }

        /* åŸºç¡€ä½“ç´ æ ·å¼ */
        .voxel {
            position: absolute;
            width: 12px;
            height: 12px;
            transform-style: preserve-3d;
            transition: all 0.15s ease;
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .voxel::before,
        .voxel::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: inherit;
        }

        .voxel::before {
            transform: translateZ(-8px) rotateY(180deg);
            filter: brightness(0.8);
        }

        .voxel::after {
            transform: rotateX(90deg) translateZ(-8px);
            filter: brightness(0.9);
        }

        .voxel:hover {
            transform: scale(1.4) translateZ(5px);
            filter: brightness(1.3);
            z-index: 100;
            border-color: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px currentColor;
        }

        /* åœ°é¢ */
        .ground {
            background: #2C3E50;
            width: 100%;
            height: 50px;
            bottom: 0;
            position: absolute;
            transform: translateZ(-5px);
            filter: brightness(0.8);
        }

        /* å»ºç­‘ç±»å‹é¢œè‰²ç³»ç»Ÿ */
        .building-old { background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); }
        .building-residential { background: linear-gradient(135deg, #6B8E23 0%, #8FBC8F 100%); }
        .building-office { background: linear-gradient(135deg, #4682B4 0%, #87CEEB 100%); }
        .building-leader { background: linear-gradient(135deg, #FF6B6B 0%, #FFA500 100%); }
        .building-crystal { background: linear-gradient(135deg, #E0E0E0 0%, #F0F8FF 100%); }
        .building-pearl { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); }
        .building-tower { background: linear-gradient(135deg, #4B0082 0%, #9370DB 100%); }
        .building-bridge { background: linear-gradient(135deg, #5F9EA0 0%, #B0C4DE 100%); }

        /* ç‰¹æ®Šå»ºç­‘ç»“æ„ */
        .window {
            background: rgba(255, 255, 200, 0.9);
            width: 8px;
            height: 8px;
            box-shadow: inset 0 0 2px rgba(0,0,0,0.3);
        }

        .window::before,
        .window::after {
            background: rgba(255, 255, 200, 0.9);
        }

        .antenna {
            background: #C0C0C0;
            width: 4px;
            height: 4px;
        }

        .spire {
            background: #FFD700;
            width: 6px;
            height: 6px;
            animation: blink 2s ease-in-out infinite;
        }

        .bridge-cable {
            background: transparent;
            width: 30px;
            height: 1px;
            border-top: 2px solid #4682B4;
            transform-origin: left;
            transform: rotateZ(-45deg) translateZ(-2px);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.7; filter: brightness(1.5); }
        }

        /* åŠ¨æ€æ•ˆæœ */
        .lit {
            animation: window-light 6s ease-in-out infinite;
        }

        @keyframes window-light {
            0%, 100% { background: rgba(255, 255, 200, 0.9); }
            50% { background: rgba(255, 255, 150, 1); filter: brightness(1.5); }
        }

        .glow {
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor; }
        }

        /* ä¿¡æ¯é¢æ¿ */
        .info-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(20, 20, 40, 0.95);
            color: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(100, 150, 255, 0.5);
            font-size: 12px;
            max-width: 220px;
            line-height: 1.6;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.4s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .info-panel.show {
            opacity: 1;
            transform: translateX(0);
        }

        .info-panel h3 {
            color: #FFD700;
            margin-bottom: 8px;
            font-size: 14px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 4px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .info-panel ul {
            list-style: none;
            padding-left: 0;
            margin: 0;
        }

        .info-panel li {
            margin: 3px 0;
            padding-left: 12px;
            position: relative;
        }

        .info-panel li::before {
            content: 'â—†';
            position: absolute;
            left: 0;
            color: #FF6B6B;
        }

        /* å»ºç­‘æ ‡è®° */
        .building-label {
            position: absolute;
            color: #FFD700;
            font-size: 10px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 999;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .building-label.show {
            opacity: 1;
            animation: float-up 2s ease-out forwards;
        }

        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-20px); opacity: 0; }
        }

        /* èƒŒæ™¯è£…é¥° */
        .stars {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s ease-in-out infinite;
            opacity: 0.8;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        /* ç²’å­ */
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: particle-float 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes particle-float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            50% { transform: translateY(-40px) translateX(20px); }
        }

        /* ç¯å…‰å…‰æ™• */
        .light-glow {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(255, 200, 50, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(8px);
            animation: pulse-glow 3s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .cityscape { transform: scale(0.8); }
            .header h1 { font-size: 28px; }
            .info-panel { font-size: 11px; max-width: 180px; top: 70px; right: 10px; }
        }

        @media (max-width: 768px) {
            .cityscape { transform: scale(0.6); }
            .header h1 { font-size: 22px; }
            .header p { font-size: 11px; }
        }

        /* ç‰¹æ®Šæ•ˆæœ - è§†å·® */
        .parallax-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        /* æ°´å¹³æ»šåŠ¨ */
        .pan {
            animation: pan-scan 25s linear infinite;
        }

        @keyframes pan-scan {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(50px); }
        }

        /* äº¤äº’æç¤º */
        .hint {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.7);
            font-size: 11px;
            background: rgba(0,0,0,0.4);
            padding: 6px 12px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            animation: fade-in 2s ease-out forwards;
            z-index: 999;
        }

        @keyframes fade-in {
            0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜ -->
        <div class="header">
            <h1>ä¸Šæµ·å¤©é™…çº¿</h1>
            <p>SHANGHAI SKYLINE â€¢ ä½“ç´ è‰ºæœ¯ â€¢ æµ¦ä¸œé£æƒ…</p>
        </div>

        <!-- ä¿¡æ¯é¢æ¿ -->
        <div class="info-panel" id="infoPanel">
            <h3>ğŸ™ï¸ æ ‡å¿—æ€§å»ºç­‘</h3>
            <ul>
                <li>ä¸Šæµ·ä¸­å¿ƒ (632m)</li>
                <li>ç¯çƒé‡‘èä¸­å¿ƒ (492m)</li>
                <li>é‡‘èŒ‚å¤§å¦ (420.5m)</li>
                <li>ä¸œæ–¹æ˜ç  (468m)</li>
                <li>å—æµ¦å¤§æ¡¥ (834mä¸»è·¨)</li>
                <li>å¤–æ»©å†å²å»ºç­‘ç¾¤</li>
                <li>ä¼ ç»ŸçŸ³åº“é—¨</li>
            </ul>
            <p style="margin-top: 8px; color: #aaa; line-height: 1.4;">
                ğŸ’¡ ç‚¹å‡»è§‚å¯Ÿ Â· ğŸ–±ï¸ æ‹–åŠ¨æ—‹è½¬ Â· âš¡ å¼€å¯ç‰¹æ•ˆ
            </p>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="controls">
            <button class="btn" onclick="toggleRotate()">ğŸ”„ æ—‹è½¬</button>
            <button class="btn" onclick="toggleInfo()">ğŸ“š å»ºç­‘</button>
            <button class="btn" onclick="toggleLights()">ğŸ’¡ ç¯å…‰</button>
            <button class="btn" onclick="toggleWeather()">ğŸŒ§ï¸ çƒŸé›¨</button>
            <button class="btn" onclick="toggleParallax()">ğŸ­ è§†å·®</button>
            <button class="btn" onclick="resetView()">ğŸ  é‡ç½®</button>
        </div>

        <!-- æç¤º -->
        <div class="hint" id="hint">ç‚¹å‡»ä»»æ„å»ºç­‘æŸ¥çœ‹è¯¦æƒ… â€¢ é¼ æ ‡æ‚¬åœæ”¾å¤§</div>

        <!-- åŸå¸‚åœºæ™¯ -->
        <div class="cityscape" id="cityscape">
            <!-- ç²’å­å®¹å™¨ -->
            <div id="particles" style="position: absolute; width: 100%; height: 100%;"></div>

            <!-- æ˜Ÿç©º -->
            <div id="stars" style="position: absolute; width: 100%; height: 100%;"></div>

            <!-- åœ°é¢ -->
            <div class="ground"></div>

            <!-- å»ºç­‘ç¾¤å¼€å§‹ -->

            <!-- å·¦ä¾§ï¼šå†å²å»ºç­‘ç¾¤ -->
            <div id="historic-district"></div>

            <!-- ä¸­å¿ƒï¼šé™†å®¶å˜´æ ¸å¿ƒåŒº -->
            <div id="lujiazui-core"></div>

            <!-- å³ä¾§ï¼šç°ä»£å»ºç­‘ -->
            <div id="modern-district"></div>

            <!-- æ¡¥æ¢ -->
            <div id="bridge"></div>

            <!-- æµ¦ä¸œå¤©é™…çº¿ -->
            <div id="pudong-skyline"></div>

            <!-- å¤–æ»©å»ºç­‘ç¾¤ -->
            <div id="bund-buildings"></div>

            <!-- èƒŒæ™¯å±‚ -->
            <div id="background-layer"></div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let state = {
            rotate: true,
            showInfo: false,
            lightsOn: false,
            weatherOn: false,
            parallaxOn: false,
            buildings: []
        };

        // å»ºç­‘æ•°æ®
        const buildingsData = [
            // ä¸œæ–¹æ˜ç 
            { name: "ä¸œæ–¹æ˜ç ", type: "pearl", x: 120, y: 200, height: 20, width: 3, color: "#FFD700", special: "sphere" },
            // é‡‘èŒ‚å¤§å¦
            { name: "é‡‘èŒ‚å¤§å¦", type: "classic", x: 150, y: 180, height: 18, width: 4, color: "#4682B4" },
            // ç¯çƒé‡‘èä¸­å¿ƒ
            { name: "ç¯çƒé‡‘èä¸­å¿ƒ", type: "office", x: 180, y: 170, height: 20, width: 5, color: "#00CED1", special: "trapezoid" },
            // ä¸Šæµ·ä¸­å¿ƒ
            { name: "ä¸Šæµ·ä¸­å¿ƒ", type: "leader", x: 210, y: 160, height: 28, width: 4, color: "#FF6B6B", special: "spiral" },

            // å³ä¾§ç°ä»£å»ºç­‘
            { name: "éœ‡æ—¦å¤§å¦", type: "residential", x: 260, y: 200, height: 15, width: 3, color: "#9370DB" },
            { name: "èŠ±æ——é›†å›¢", type: "office", x: 285, y: 210, height: 13, width: 4, color: "#87CEEB" },
            { name: "æœªæ¥å»ºç­‘", type: "crystal", x: 315, y: 220, height: 12, width: 3, color: "#E0E0E0" },

            // å¤–æ»©å†å²å»ºç­‘
            { name: "å’Œå¹³é¥­åº—", type: "old", x: 380, y: 230, height: 8, width: 5, color: "#A0522D" },
            { name: "æµ·å…³å¤§æ¥¼", type: "old", x: 410, y: 225, height: 9, width: 4, color: "#8B4513", special: "clock" },
            { name: "å¤–æ»©18å·", type: "old", x: 440, y: 232, height: 7, width: 5, color: "#696969" },
            { name: "æ±‡ä¸°é“¶è¡Œ", type: "old", x: 470, y: 228, height: 8, width: 4, color: "#A0522D" },

            // ä¼ ç»Ÿå»ºç­‘
            { name: "çŸ³åº“é—¨", type: "old", x: 520, y: 245, height: 5, width: 3, color: "#8B6969" },
            { name: " aggregate", type: "old", x: 540, y: 245, height: 5, width: 3, color: "#9C7C5F" },

            // å·¦ä¾§ç°ä»£ç¾¤æ¥¼
            { name: "ç™½ç‰å…°", type: "office", x: 70, y: 220, height: 10, width: 4, color: "#87CEEB" },
            { name: "å‡¯å¾·", type: "residential", x: 95, y: 215, height: 11, width: 3, color: "#6B8E23" },
            { name: "åŒ—å¤–æ»©", type: "office", x: 40, y: 210, height: 12, width: 4, color: "#4682B4" }
        ];

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            createStars();
            createBuildings();
            createParticles();
            setupInteractions();
            startAutoHint();

            // è‡ªåŠ¨æ˜¾ç¤ºä¿¡æ¯é¢æ¿å¼•å¯¼
            setTimeout(() => {
                toggleInfo();
            }, 2000);
        }

        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        function createStars() {
            const container = document.getElementById('stars');
            for (let i = 0; i < 80; i++) {
                const star = document.createElement('div');
                star.className = 'stars';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 40 + '%';
                star.style.animationDelay = Math.random() * 4 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                container.appendChild(star);
            }
        }

        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 25; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = (Math.random() * 80 + 10) + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                container.appendChild(particle);
            }
        }

        // åˆ›å»ºæ‰€æœ‰å»ºç­‘
        function createBuildings() {
            const historic = document.getElementById('historic-district');
            const lujiazui = document.getElementById('lujiazui-core');
            const modern = document.getElementById('modern-district');
            const bund = document.getElementById('bund-buildings');
            const main = document.getElementById('pudong-skyline');
            const bg = document.getElementById('background-layer');
            const bridge = document.getElementById('bridge');

            buildingsData.forEach((building, index) => {
                // é€‰æ‹©å®¹å™¨
                let container;
                if (index < 4) container = main;
                else if (index < 7) container = modern;
                else if (index < 11) container = bund;
                else if (index < 13) container = historic;
                else container = lujiazui;

                createBuilding(building, container, index);
            });

            // åˆ›å»ºæ¡¥æ¢
            createBridge(bridge);

            // èƒŒæ™¯å»ºç­‘
            createBackground(bg);
        }

        // åˆ›å»ºå•ä¸ªå»ºç­‘
        function createBuilding(data, container, index) {
            const baseX = data.x;
            const baseY = data.y;

            // å»ºç­‘ä¸»ä½“
            for (let h = 0; h < data.height; h++) {
                const voxel = document.createElement('div');
                voxel.className = `voxel building-${data.type}`;
                voxel.style.transform = `translate3d(${baseX}px, ${baseY - (h * 12)}px, ${h * 2}px)`;
                voxel.dataset.name = data.name;
                voxel.dataset.type = data.type;
                voxel.dataset.index = index;

                // éšæœºæ·»åŠ ä¸€äº›çª—æˆ·
                if (Math.random() > 0.6 && h > 1) {
                    voxel.classList.add('window');
                    voxel.style.opacity = '0.9';
                }

                // ç‰¹æ®Šå»ºç­‘é¡¶éƒ¨
                if (h === data.height - 1) {
                    if (data.special === 'spire') {
                        const spire = document.createElement('div');
                        spire.className = 'voxel spire';
                        spire.style.transform = `translate3d(${baseX}px, ${baseY - (h * 12)}px, ${h * 2 + 5}px)`;
                        spire.dataset.name = data.name + ' (å¡”å°–)';
                        container.appendChild(spire);
                    } else if (data.special === 'sphere') {
                        // çç çƒä½“
                        for (let i = 0; i < 5; i++) {
                            const sphere = document.createElement('div');
                            sphere.className = 'voxel building-pearl';
                            sphere.style.transform = `translate3d(${baseX - 12 + i*4}px, ${baseY - (h * 12) - 10}px, ${h * 2 + 2}px)`;
                            sphere.style.borderRadius = '50%';
                            sphere.style.width = '8px';
                            sphere.style.height = '8px';
                            sphere.dataset.name = data.name + ' (çƒä½“)';
                            if (i === 0 || i === 4) {
                                sphere.classList.add('glow');
                            }
                            container.appendChild(sphere);
                        }
                    } else if (data.special === 'trapezoid') {
                        // ç¯çƒä¸­å¿ƒæ¢¯å½¢
                        const trap = document.createElement('div');
                        trap.className = 'voxel building-office';
                        trap.style.transform = `translate3d(${baseX}px, ${baseY - (h * 12)}px, ${h * 2 + 2}px)`;
                        trap.style.width = '16px';
                        trap.style.borderRadius = '8px 8px 0 0';
                        trap.dataset.name = data.name + ' (é¡¶éƒ¨)';
                        container.appendChild(trap);
                    }
                }

                // éšæœºæ·»åŠ å¤©çº¿
                if (h === data.height - 2 && Math.random() > 0.7 && !data.special) {
                    const antenna = document.createElement('div');
                    antenna.className = 'voxel antenna';
                    antenna.style.transform = `translate3d(${baseX + 2}px, ${baseY - (h * 12)}px, ${h * 2 + 3}px)`;
                    antenna.dataset.name = data.name + ' (å¤©çº¿)';
                    container.appendChild(antenna);
                }

                // ä¸œæ–¹æ˜ç çš„ç‰¹æ®Šå¤„ç† - å•ç‹¬åˆ›å»º
                if (data.special === 'sphere') continue;

                container.appendChild(voxel);
            }

            // æ·»åŠ æ ‡ç­¾ï¼ˆç”¨äºæ˜¾ç¤ºå»ºç­‘åç§°ï¼‰
            const label = document.createElement('div');
            label.className = 'building-label';
            label.textContent = data.name;
            label.style.left = baseX + 'px';
            label.style.top = (baseY - data.height * 12 - 10) + 'px';
            label.style.transform = 'translateX(-50%)';
            label.id = `label-${index}`;
            container.appendChild(label);

            state.buildings.push({
                ...data,
                container: container,
                index: index
            });
        }

        // åˆ›å»ºæ¡¥æ¢
        function createBridge(container) {
            const bridgeStart = 580;
            const bridgeY = 260;

            // æ¡¥å¡”
            for (let i = 0; i < 6; i++) {
                const tower1 = document.createElement('div');
                tower1.className = 'voxel building-bridge';
                tower1.style.transform = `translate3d(${bridgeStart}px, ${bridgeY - i * 12}px, ${i}px)`;
                tower1.dataset.name = "å—æµ¦å¤§æ¡¥ (æ¡¥å¡”)";
                container.appendChild(tower1);

                const tower2 = document.createElement('div');
                tower2.className = 'voxel building-bridge';
                tower2.style.transform = `translate3d(${bridgeStart + 100}px, ${bridgeY - i * 12}px, ${i}px)`;
                tower2.dataset.name = "å—æµ¦å¤§æ¡¥ (æ¡¥å¡”)";
                container.appendChild(tower2);
            }

            // æ‹‰ç´¢
            for (let i = 0; i < 8; i++) {
                const cable = document.createElement('div');
                cable.className = 'voxel bridge-cable';
                cable.style.transform = `translate3d(${bridgeStart + i * 12}px, ${bridgeY - 20}px, 0px) rotateZ(-45deg)`;
                cable.style.width = '12px';
                container.appendChild(cable);

                const cable2 = document.createElement('div');
                cable2.className = 'voxel bridge-cable';
                cable2.style.transform = `translate3d(${bridgeStart + 50 + i * 12}px, ${bridgeY - 25}px, 0px) rotateZ(45deg)`;
                cable2.style.width = '12px';
                container.appendChild(cable2);
            }

            // æ¡¥é¢
            for (let i = 0; i < 16; i++) {
                const deck = document.createElement('div');
                deck.className = 'voxel building-bridge';
                deck.style.transform = `translate3d(${bridgeStart + i * 6}px, ${bridgeY + 30}px, 0px)`;
                deck.style.width = '6px';
                deck.dataset.name = "å—æµ¦å¤§æ¡¥";
                container.appendChild(deck);
            }
        }

        // åˆ›å»ºèƒŒæ™¯å»ºç­‘
        function createBackground(container) {
            // å·¦ä¾§è¿œæ™¯
            for (let i = 0; i < 8; i++) {
                const group = document.createElement('div');
                const h = Math.floor(Math.random() * 8) + 5;

                for (let j = 0; j < h; j++) {
                    const voxel = document.createElement('div');
                    voxel.className = 'voxel';
                    voxel.style.background = 'rgba(40, 50, 70, 0.4)';
                    voxel.style.transform = `translate3d(${40 + i * 15}px, ${250 - j * 10}px, ${-50 - j}px)`;
                    voxel.style.width = '10px';
                    voxel.style.height = '10px';
                    container.appendChild(voxel);
                }
            }

            // å³ä¾§è¿œæ™¯
            for (let i = 0; i < 8; i++) {
                const h = Math.floor(Math.random() * 6) + 4;
                for (let j = 0; j < h; j++) {
                    const voxel = document.createElement('div');
                    voxel.className = 'voxel';
                    voxel.style.background = 'rgba(50, 60, 80, 0.4)';
                    voxel.style.transform = `translate3d(${330 + i * 12}px, ${240 - j * 8}px, ${-50 - j}px)`;
                    voxel.style.width = '8px';
                    voxel.style.height = '8px';
                    container.appendChild(voxel);
                }
            }
        }

        // äº¤äº’åŠŸèƒ½
        function setupInteractions() {
            const cityscape = document.getElementById('cityscape');

            // ç‚¹å‡»å»ºç­‘
            cityscape.addEventListener('click', (e) => {
                if (e.target.classList.contains('voxel') && !e.target.classList.contains('ground')) {
                    const name = e.target.dataset.name || 'å»ºç­‘';
                    const rect = e.target.getBoundingClientRect();

                    // æ˜¾ç¤ºæ ‡ç­¾
                    showLabel(name, rect.left, rect.top, e.target.dataset.index);

                    // æ·»åŠ ç‚¹å‡»åé¦ˆ - çŸ­æš‚é—ªçƒ
                    e.target.style.filter = 'brightness(2) saturate(2)';
                    setTimeout(() => {
                        e.target.style.filter = '';
                    }, 300);

                    // åˆ›å»ºåé¦ˆç²’å­
                    e.target.style.transform += ' scale(1.2)';
                    setTimeout(() => {
                        e.target.style.transform = e.target.style.transform.replace(' scale(1.2)', '');
                    }, 150);
                }
            });

            // é¼ æ ‡ç§»åŠ¨è§†å·®
            document.addEventListener('mousemove', (e) => {
                if (!state.rotate && state.parallaxOn) {
                    const x = (e.clientX / window.innerWidth - 0.5) * 30;
                    const y = (e.clientY / window.innerHeight - 0.5) * 15;
                    cityscape.style.transform = `rotateY(${x}deg) rotateX(${-y}deg)`;
                }
            });

            // ç§»é™¤æç¤º
            setTimeout(() => {
                const hint = document.getElementById('hint');
                if (hint) {
                    hint.style.transition = 'opacity 1s ease';
                    hint.style.opacity = '0';
                    setTimeout(() => hint.remove(), 1000);
                }
            }, 8000);
        }

        // æ˜¾ç¤ºå»ºç­‘æ ‡ç­¾
        function showLabel(name, x, y, index) {
            const label = document.getElementById(`label-${index}`);
            if (label) {
                label.textContent = name;
                label.style.left = x + 'px';
                label.style.top = (y - 30) + 'px';
                label.classList.add('show');

                setTimeout(() => {
                    label.classList.remove('show');
                }, 2000);
            }
        }

        // æ§åˆ¶å‡½æ•°
        function toggleRotate() {
            state.rotate = !state.rotate;
            const cityscape = document.getElementById('cityscape');
            const btn = event.target;

            if (state.rotate) {
                cityscape.classList.remove('paused');
                btn.textContent = 'ğŸ”„ æ—‹è½¬';
                btn.classList.remove('active');
            } else {
                cityscape.classList.add('paused');
                btn.textContent = 'â¸ï¸ åœæ­¢';
                btn.classList.add('active');
            }
        }

        function toggleInfo() {
            state.showInfo = !state.showInfo;
            const panel = document.getElementById('infoPanel');
            const btn = event.target;

            if (state.showInfo) {
                panel.classList.add('show');
                btn.classList.add('active');
            } else {
                panel.classList.remove('show');
                btn.classList.remove('active');
            }
        }

        function toggleLights() {
            state.lightsOn = !state.lightsOn;
            const windows = document.querySelectorAll('.window');
            const btn = event.target;
            const cityscape = document.getElementById('cityscape');

            if (state.lightsOn) {
                windows.forEach(w => w.classList.add('lit'));
                btn.classList.add('active');
                btn.textContent = 'ğŸ’¡ ç†„ç¯';

                // æ·»åŠ å…‰æ™•
                addLightGlows();
                cityscape.style.animation = 'gentle-float 10s ease-in-out infinite';
            } else {
                windows.forEach(w => w.classList.remove('lit'));
                btn.classList.remove('active');
                btn.textContent = 'ğŸ’¡ ç¯å…‰';

                // ç§»é™¤å…‰æ™•
                const glows = document.querySelectorAll('.light-glow');
                glows.forEach(g => g.remove());
                cityscape.style.animation = '';
            }
        }

        function addLightGlows() {
            const cityscape = document.getElementById('cityscape');
            const randomPositions = [
                { x: 120, y: 180 }, { x: 150, y: 160 }, { x: 180, y: 150 },
                { x: 210, y: 140 }, { x: 380, y: 210 }, { x: 410, y: 205 },
                { x: 440, y: 210 }, { x: 185, y: 150 }, { x: 205, y: 140 }
            ];

            randomPositions.forEach(pos => {
                const glow = document.createElement('div');
                glow.className = 'light-glow';
                glow.style.left = (pos.x - 20) + 'px';
                glow.style.top = (pos.y - 20) + 'px';
                cityscape.appendChild(glow);

                setTimeout(() => {
                    glow.style.animationDelay = Math.random() * 3 + 's';
                }, 100);
            });
        }

        function toggleWeather() {
            state.weatherOn = !state.weatherOn;
            const btn = event.target;
            const cityscape = document.getElementById('cityscape');

            if (state.weatherOn) {
                addRainEffect();
                btn.classList.add('active');
                btn.textContent = 'â˜€ï¸ æ™´æœ—';

                // æ”¹å˜èƒŒæ™¯è‰²è°ƒ
                cityscape.style.filter = 'contrast(1.2) brightness(0.9) saturate(0.8)';
            } else {
                removeRainEffect();
                btn.classList.remove('active');
                btn.textContent = 'ğŸŒ§ï¸ çƒŸé›¨';

                cityscape.style.filter = '';
            }
        }

        function addRainEffect() {
            const cityscape = document.getElementById('cityscape');

            for (let i = 0; i < 40; i++) {
                const rain = document.createElement('div');
                rain.className = 'particle';
                rain.style.width = '1px';
                rain.style.height = '15px';
                rain.style.background = 'linear-gradient(to bottom, transparent, rgba(174, 194, 224, 0.6))';
                rain.style.left = Math.random() * 100 + '%';
                rain.style.top = Math.random() * 100 + '%';
                rain.style.animation = `rain-fall ${0.5 + Math.random() * 0.5}s linear infinite`;
                rain.style.animationDelay = Math.random() * 2 + 's';
                rain.dataset.rain = 'true';
                cityscape.appendChild(rain);
            }

            // åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes rain-fall {
                    0% { transform: translateY(-20px) translateX(0); opacity: 0; }
                    10% { opacity: 0.8; }
                    100% { transform: translateY(200px) translateX(20px); opacity: 0; }
                }
            `;
            style.id = 'rain-style';
            document.head.appendChild(style);

            // é›¾æ°”æ•ˆæœ
            const mist = document.createElement('div');
            mist.style.position = 'absolute';
            mist.style.width = '200%';
            mist.style.height = '100%';
            mist.style.left = '-50%';
            mist.style.background = 'radial-gradient(ellipse at center, rgba(200,220,240,0.15) 0%, transparent 70%)';
            mist.style.pointerEvents = 'none';
            mist.style.animation = 'mist-move 6s ease-in-out infinite';
            mist.style.filter = 'blur(2px)';
            mist.id = 'mist';
            cityscape.appendChild(mist);

            const mistStyle = document.createElement('style');
            mistStyle.textContent = `
                @keyframes mist-move {
                    0%, 100% { transform: translateX(0); opacity: 0.4; }
                    50% { transform: translateX(20px); opacity: 0.6; }
                }
            `;
            mistStyle.id = 'mist-style';
            document.head.appendChild(mistStyle);
        }

        function removeRainEffect() {
            const rains = document.querySelectorAll('[data-rain="true"]');
            rains.forEach(r => r.remove());
            const mist = document.getElementById('mist');
            if (mist) mist.remove();

            const rainStyle = document.getElementById('rain-style');
            const mistStyle = document.getElementById('mist-style');
            if (rainStyle) rainStyle.remove();
            if (mistStyle) mistStyle.remove();
        }

        function toggleParallax() {
            state.parallaxOn = !state.parallaxOn;
            const btn = event.target;

            if (state.parallaxOn) {
                btn.classList.add('active');
                btn.textContent = 'ğŸ­ ç«‹ä½“';

                // æ˜¾ç¤ºå¼•å¯¼
                showFloatingHint('é¼ æ ‡ç§»åŠ¨æŸ¥çœ‹3Dè§†å·®æ•ˆæœ');
            } else {
                btn.classList.remove('active');
                btn.textContent = 'ğŸ­ è§†å·®';
                document.getElementById('cityscape').style.transform = '';
            }
        }

        function resetView() {
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            if (state.rotate) toggleRotate();
            if (state.showInfo) toggleInfo();
            if (state.lightsOn) toggleLights();
            if (state.weatherOn) toggleWeather();
            if (state.parallaxOn) toggleParallax();

            const cityscape = document.getElementById('cityscape');
            cityscape.style.transform = '';
            cityscape.classList.remove('paused');

            state.rotate = true;
            event.target.textContent = 'ğŸ  é‡ç½®';
            event.target.classList.add('active');

            setTimeout(() => {
                event.target.classList.remove('active');
            }, 500);

            // æ˜¾ç¤ºæ¬¢è¿æ ‡ç­¾
            showFloatingHint('æ¬¢è¿æ¥åˆ°ä¸Šæµ·ä½“ç´ å¤©é™…çº¿ï¼');
        }

        // è¾…åŠ©å‡½æ•°
        function showFloatingHint(text) {
            const hint = document.createElement('div');
            hint.style.position = 'absolute';
            hint.style.top = '50%';
            hint.style.left = '50%';
            hint.style.transform = 'translate(-50%, -50%)';
            hint.style.color = 'white';
            hint.style.fontSize = '16px';
            hint.style.fontWeight = 'bold';
            hint.style.background = 'rgba(0,0,0,0.7)';
            hint.style.padding = '15px 25px';
            hint.style.borderRadius = '8px';
            hint.style.zIndex = '2000';
            hint.style.backdropFilter = 'blur(10px)';
            hint.style.textAlign = 'center';
            hint.textContent = text;
            hint.style.animation = 'fade-in-out 2s ease-in-out forwards';

            document.body.appendChild(hint);

            const style = document.createElement('style');
            style.textContent = `
                @keyframes fade-in-out {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);

            setTimeout(() => {
                hint.remove();
                style.remove();
            }, 2000);
        }

        // è‡ªåŠ¨æç¤ºå¾ªç¯
        function startAutoHint() {
            const tips = [
                'ğŸ’¡ ç‚¹å‡»å»ºç­‘æŸ¥çœ‹åç§°',
                'ğŸ”„ ä½¿ç”¨æ—‹è½¬åŠŸèƒ½å…¨æ–¹ä½è§‚å¯Ÿ',
                'ğŸŒŠ å¼€å¯çƒŸé›¨æ•ˆæœï¼Œæ„Ÿå—æµ¦ä¸œé£æƒ…',
                'ğŸ ç§»åŠ¨é¼ æ ‡ä½“éªŒè§†å·®3D',
                'âœ¨ æ‰€æœ‰å»ºç­‘éƒ½æ˜¯å¯äº¤äº’çš„ï¼'
            ];

            let index = 0;
            setInterval(() => {
                if (!document.getElementById('hint') && !state.showInfo) {
                    showFloatingHint(tips[index]);
                    index = (index + 1) % tips.length;
                }
            }, 12000);
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    toggleRotate();
                    break;
                case 'l':
                case 'L':
                    toggleLights();
                    break;
                case 'r':
                case 'R':
                    toggleWeather();
                    break;
                case 'i':
                case 'I':
                    toggleInfo();
                    break;
                case 'p':
                case 'P':
                    toggleParallax();
                    break;
                case '0':
                    resetView();
                    break;
            }
        });

        // å¯åŠ¨
        window.addEventListener('load', init);
    </script>
</body>
</html>