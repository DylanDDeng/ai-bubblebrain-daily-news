{{ define "main" }}
<section class="section">
  <div class="section-narrow eval-shell">
    <header class="page-header gallery-hero">
      <p class="page-eyebrow">Bubble's Brain</p>
      <h1>{{ .Title }}</h1>
      {{ with .Params.description }}
        <p class="page-desc">{{ . }}</p>
      {{ end }}
    </header>

    <!-- ÊêúÁ¥¢Ê°Ü -->
    <div class="eval-search-bar">
      <input type="text" id="eval-search" class="eval-search-input" placeholder="{{ i18n "eval_search_placeholder" | default "ÊêúÁ¥¢Ê®°ÂûãÂêçÁß∞„ÄÅÂÖ¨Âè∏„ÄÅÊ†áÁ≠æ..." }}">
    </div>

    <div id="model-grid" class="eval-grid" aria-live="polite"></div>
    <div id="model-empty" class="eval-empty" hidden>
      <p>{{ i18n "eval_empty_title" }}</p>
      <p>{{ i18n "eval_empty_hint" }}</p>
    </div>
  </div>
</section>

<!-- È¢òÁõÆÂàóË°®ÂºπÊ°Ü -->
<div class="eval-modal" id="questions-modal" aria-hidden="true">
  <div class="eval-modal__backdrop" data-close></div>
  <div class="eval-modal__dialog" role="dialog" aria-modal="true">
    <button class="eval-modal__close" type="button" data-close aria-label="{{ i18n "eval_modal_close" }}">&times;</button>
    <div class="eval-modal__header">
      <h2 id="modal-model-name">{{ i18n "eval_modal_questions_title" }}</h2>
      <p id="modal-model-company" class="modal-company"></p>
    </div>
    <div class="eval-modal__body">
      <div class="question-filters" id="question-filters"></div>
      <div class="question-list" id="question-list"></div>
    </div>
  </div>
</div>

<!-- ÂõûÁ≠îËØ¶ÊÉÖÂºπÊ°Ü -->
<div class="eval-modal" id="answer-modal" aria-hidden="true">
  <div class="eval-modal__backdrop" data-close></div>
  <div class="eval-modal__dialog eval-modal__dialog--wide" role="dialog" aria-modal="true">
    <button class="eval-modal__close" type="button" data-close aria-label="{{ i18n "eval_modal_close" }}">&times;</button>

    <!-- ÂØºËà™ÊåâÈíÆ -->
    <div class="answer-nav">
      <button class="answer-nav__btn answer-nav__prev" id="answer-prev" title="‰∏ä‰∏ÄÈ¢ò (‚Üê)">
        <span>‚Üê</span> ‰∏ä‰∏ÄÈ¢ò
      </button>
      <span class="answer-nav__indicator" id="answer-indicator">1 / 4</span>
      <button class="answer-nav__btn answer-nav__next" id="answer-next" title="‰∏ã‰∏ÄÈ¢ò (‚Üí)">
        ‰∏ã‰∏ÄÈ¢ò <span>‚Üí</span>
      </button>
    </div>

    <div class="eval-modal__header">
      <p class="answer-breadcrumb"><span id="answer-model"></span> / <span id="answer-category"></span></p>
      <h2 id="answer-title">{{ i18n "eval_modal_answer_title" }}</h2>
      <!-- ÂàÜ‰∫´ÊåâÈíÆ -->
      <button class="share-btn" id="share-btn" title="Â§çÂà∂ÂàÜ‰∫´ÈìæÊé•">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
          <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
        </svg>
        <span id="share-btn-text">ÂàÜ‰∫´</span>
      </button>
    </div>
    <div class="eval-modal__body">
      <div class="answer-question">
        <h4>{{ i18n "eval_question_label" }}</h4>
        <p id="answer-question-text"></p>
      </div>
      <!-- ÂÖ®Â±èÊåâÈíÆÂÆπÂô® -->
      <div class="answer-toolbar" id="answer-toolbar" style="display:none;">
        <button class="fullscreen-btn" id="fullscreen-btn" title="ÂÖ®Â±èÊü•Áúã">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
          </svg>
          ÂÖ®Â±èÊü•Áúã
        </button>
      </div>
      <div class="answer-content" id="answer-content"></div>
    </div>
  </div>
</div>

<script>
(() => {
  let modelsUrl = "{{ "/model-evals.json" | relLangURL }}";
  const questionsUrl = "{{ "/eval-questions.json" | relLangURL }}";

  if (window.location.pathname.includes('/2025')) {
    modelsUrl = "{{ "/model-evals-2025.json" | relLangURL }}";
  } else if (window.location.pathname.includes('/2026')) {
    modelsUrl = "{{ "/model-evals-2026.json" | relLangURL }}";
  }

  const I18N = {
    modalQuestionsTitle: "{{ i18n "eval_modal_questions_title" }}",
    unknownModel: "{{ i18n "eval_unknown_model" }}",
    viewQuestions: "{{ i18n "eval_view_questions" }}",
    allWithCount: "{{ i18n "eval_filter_all_with_count" }}",
    noQuestions: "{{ i18n "eval_no_questions" }}",
    viewAnswer: "{{ i18n "eval_view_answer" }}",
    generatedImageAlt: "{{ i18n "eval_generated_image_alt" }}",
    questionsCount: "{{ i18n "eval_questions_count" | default "{count} ÈÅìÈ¢òÁõÆ" }}"
  };

  const grid = document.getElementById("model-grid");
  const empty = document.getElementById("model-empty");
  const searchInput = document.getElementById("eval-search");

  const questionsModal = document.getElementById("questions-modal");
  const modalModelName = document.getElementById("modal-model-name");
  const modalModelCompany = document.getElementById("modal-model-company");
  const questionFilters = document.getElementById("question-filters");
  const questionList = document.getElementById("question-list");

  const answerModal = document.getElementById("answer-modal");
  const answerModel = document.getElementById("answer-model");
  const answerCategory = document.getElementById("answer-category");
  const answerTitle = document.getElementById("answer-title");
  const answerQuestionText = document.getElementById("answer-question-text");
  const answerContent = document.getElementById("answer-content");
  const answerToolbar = document.getElementById("answer-toolbar");
  const fullscreenBtn = document.getElementById("fullscreen-btn");
  const shareBtn = document.getElementById("share-btn");
  const shareBtnText = document.getElementById("share-btn-text");

  // ÂØºËà™ÂÖÉÁ¥†
  const answerPrev = document.getElementById("answer-prev");
  const answerNext = document.getElementById("answer-next");
  const answerIndicator = document.getElementById("answer-indicator");

  let allModels = [];
  let allQuestions = [];
  let filteredModels = [];
  let currentModelId = null;
  let currentCategory = "all";
  let currentQuestionIndex = 0;
  let currentFilteredQuestions = [];
  let revealObserver = null;
  let searchTerm = "";

  function setEmpty(show) {
    if (empty) empty.hidden = !show;
  }

  // Ëé∑ÂèñÊ®°ÂûãÁöÑÈ¢òÁõÆÊï∞Èáè
  function getModelQuestionCount(modelId) {
    return allQuestions.filter(q => q.answers && q.answers[modelId]).length;
  }

  function buildModelCard(model) {
    const card = document.createElement("article");
    card.className = "eval-card reveal-text";
    card.dataset.modelId = model.id;

    const logoWrap = document.createElement("div");
    logoWrap.className = "eval-card__logo";
    if (model.logo) {
      const img = document.createElement("img");
      img.src = model.logo;
      img.alt = model.company;
      img.loading = "lazy";
      img.onerror = function() { this.style.display = 'none'; };
      logoWrap.appendChild(img);
    } else {
      logoWrap.textContent = model.company?.charAt(0) || "?";
    }

    const meta = document.createElement("div");
    meta.className = "eval-card__meta";

    const company = document.createElement("p");
    company.className = "eval-card__company";
    company.textContent = model.company || "";

    const name = document.createElement("h3");
    name.textContent = model.name || I18N.unknownModel;

    const desc = document.createElement("p");
    desc.className = "eval-card__desc";
    desc.textContent = model.description || "";

    const tagRow = document.createElement("div");
    tagRow.className = "eval-card__tags";
    (model.tags || []).forEach(tag => {
      const span = document.createElement("span");
      span.textContent = tag;
      tagRow.appendChild(span);
    });

    // È¢òÁõÆÊï∞ÈáèÊòæÁ§∫
    const questionCount = getModelQuestionCount(model.id);
    const countBadge = document.createElement("div");
    countBadge.className = "eval-card__count";
    countBadge.innerHTML = `<span class="count-number">${questionCount}</span> <span class="count-label">ÈÅìÈ¢òÁõÆ</span>`;

    const btn = document.createElement("button");
    btn.className = "eval-btn";
    btn.textContent = I18N.viewQuestions;
    btn.addEventListener("click", () => openQuestionsModal(model));

    meta.appendChild(company);
    meta.appendChild(name);
    if (desc.textContent) meta.appendChild(desc);
    if (tagRow.children.length) meta.appendChild(tagRow);
    meta.appendChild(countBadge);
    meta.appendChild(btn);

    card.appendChild(logoWrap);
    card.appendChild(meta);

    return card;
  }

  function renderModels() {
    if (!grid) return;

    // Êñ≠ÂºÄÊóßÁöÑ observer
    if (revealObserver) {
      revealObserver.disconnect();
    }

    grid.innerHTML = "";

    const modelsToRender = searchTerm ? filteredModels : allModels;

    if (!modelsToRender.length) {
      setEmpty(true);
      return;
    }
    setEmpty(false);

    const frag = document.createDocumentFragment();
    modelsToRender.forEach(model => {
      frag.appendChild(buildModelCard(model));
    });
    grid.appendChild(frag);

    // ‰ΩøÁî® Intersection Observer ÂÆûÁé∞ÊªöÂä®ÊòæÁ§∫
    requestAnimationFrame(() => {
      const cards = grid.querySelectorAll(".reveal-text");

      revealObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add("active");
            revealObserver.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: "50px 0px"
      });

      cards.forEach(card => revealObserver.observe(card));
    });
  }

  // ÊêúÁ¥¢ÂäüËÉΩ
  function applySearch() {
    const term = searchTerm.trim().toLowerCase();
    if (!term) {
      filteredModels = allModels;
    } else {
      filteredModels = allModels.filter(model => {
        const haystack = [
          model.name,
          model.company,
          model.description,
          ...(model.tags || [])
        ].map(v => (v || "").toLowerCase()).join(" ");
        return haystack.includes(term);
      });
    }
    renderModels();
  }

  if (searchInput) {
    let searchTimeout;
    searchInput.addEventListener("input", (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        searchTerm = e.target.value;
        applySearch();
      }, 200);
    });
  }

  function getModelQuestions(modelId) {
    return allQuestions.filter(q => q.answers && q.answers[modelId]);
  }

  function collectCategories(questions) {
    const cats = new Set();
    questions.forEach(q => {
      if (q.category) cats.add(q.category);
    });
    return Array.from(cats);
  }

  function renderQuestionFilters(categories, questions) {
    questionFilters.innerHTML = "";
    const frag = document.createDocumentFragment();

    const allBtn = document.createElement("button");
    allBtn.className = "eval-filter-pill active";
    allBtn.textContent = I18N.allWithCount.replace("{count}", String(questions.length));
    allBtn.dataset.cat = "all";
    frag.appendChild(allBtn);

    categories.forEach(cat => {
      const count = questions.filter(q => q.category === cat).length;
      const btn = document.createElement("button");
      btn.className = "eval-filter-pill";
      btn.textContent = `${cat} (${count})`;
      btn.dataset.cat = cat;
      frag.appendChild(btn);
    });

    questionFilters.appendChild(frag);

    questionFilters.querySelectorAll("button").forEach(btn => {
      btn.addEventListener("click", () => {
        currentCategory = btn.dataset.cat;
        questionFilters.querySelectorAll("button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        renderQuestionList();
      });
    });
  }

  function renderQuestionList() {
    const questions = getModelQuestions(currentModelId);
    let filtered = questions;
    if (currentCategory !== "all") {
      filtered = questions.filter(q => q.category === currentCategory);
    }

    // ‰øùÂ≠òÂΩìÂâçËøáÊª§ÂêéÁöÑÈ¢òÁõÆÂàóË°®
    currentFilteredQuestions = filtered;

    questionList.innerHTML = "";
    if (!filtered.length) {
      questionList.innerHTML = `<p class="no-questions">${I18N.noQuestions}</p>`;
      return;
    }

    const frag = document.createDocumentFragment();
    filtered.forEach((q, index) => {
      const item = document.createElement("div");
      item.className = "question-item";

      const header = document.createElement("div");
      header.className = "question-item__header";

      const title = document.createElement("h4");
      title.textContent = q.title;

      const badges = document.createElement("div");
      badges.className = "question-item__badges";

      const catBadge = document.createElement("span");
      catBadge.className = "badge badge--cat";
      catBadge.textContent = q.category;
      badges.appendChild(catBadge);

      if (q.difficulty) {
        const diffBadge = document.createElement("span");
        diffBadge.className = "badge badge--diff";
        diffBadge.textContent = q.difficulty;
        badges.appendChild(diffBadge);
      }

      // Â¶ÇÊûúÈ¢òÁõÆÂåÖÂê´ËßÜÈ¢ëÔºåÊòæÁ§∫ËßÜÈ¢ëÊ†áÁ≠æ
      if (typeof q.question === 'object' && q.question !== null && q.question.videoUrl) {
        const videoBadge = document.createElement("span");
        videoBadge.className = "badge badge--video";
        videoBadge.textContent = "üìπ Âê´ËßÜÈ¢ë";
        badges.appendChild(videoBadge);
      }

      header.appendChild(title);
      header.appendChild(badges);

      const questionText = document.createElement("p");
      questionText.className = "question-item__text";
      // ÊîØÊåÅ question ÊòØÂ≠óÁ¨¶‰∏≤ÊàñÂØπË±°ÔºàÂê´ËßÜÈ¢ëÔºâ
      if (typeof q.question === 'object' && q.question !== null) {
        questionText.textContent = q.question.text || '';
      } else {
        questionText.textContent = q.question;
      }

      const viewBtn = document.createElement("button");
      viewBtn.className = "eval-btn eval-btn--sm";
      viewBtn.textContent = I18N.viewAnswer;
      viewBtn.addEventListener("click", () => {
        currentQuestionIndex = index;
        openAnswerModal(q);
      });

      item.appendChild(header);
      item.appendChild(questionText);
      item.appendChild(viewBtn);

      frag.appendChild(item);
    });

    questionList.appendChild(frag);
  }

  function openQuestionsModal(model) {
    currentModelId = model.id;
    currentCategory = "all";

    modalModelName.textContent = `${model.name || I18N.unknownModel} ¬∑ ${I18N.modalQuestionsTitle}`;
    modalModelCompany.textContent = model.company;

    const questions = getModelQuestions(model.id);
    const categories = collectCategories(questions);

    renderQuestionFilters(categories, questions);
    renderQuestionList();

    questionsModal.classList.add("open");
    questionsModal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function updateNavIndicator() {
    const total = currentFilteredQuestions.length;
    const current = currentQuestionIndex + 1;
    answerIndicator.textContent = `${current} / ${total}`;

    // Á¶ÅÁî®ËæπÁïåÊåâÈíÆ
    answerPrev.disabled = currentQuestionIndex <= 0;
    answerNext.disabled = currentQuestionIndex >= total - 1;
  }

  function openAnswerModal(question) {
    const model = allModels.find(m => m.id === currentModelId);
    const answer = question.answers[currentModelId];

    answerModel.textContent = model?.name || currentModelId;
    answerCategory.textContent = question.category;
    answerTitle.textContent = question.title;
    // ÊîØÊåÅ question ÊòØÂ≠óÁ¨¶‰∏≤ÊàñÂØπË±°ÔºàÂê´ËßÜÈ¢ëÔºâ
    let questionText = '';
    let questionVideo = null;
    if (typeof question.question === 'object' && question.question !== null) {
      questionText = question.question.text || '';
      questionVideo = question.question.videoUrl || null;
    } else {
      questionText = question.question;
    }
    answerQuestionText.textContent = questionText;

    answerContent.innerHTML = "";

    // Â¶ÇÊûúÈ¢òÁõÆÂåÖÂê´ËßÜÈ¢ëÔºåÂÖàÊòæÁ§∫ËßÜÈ¢ë
    if (questionVideo) {
      const videoContainer = document.createElement("div");
      videoContainer.className = "answer-video-container";
      
      const videoLabel = document.createElement("p");
      videoLabel.className = "answer-video-label";
      videoLabel.textContent = "üìπ ÂèÇËÄÉËßÜÈ¢ëÔºö";
      
      const video = document.createElement("video");
      video.className = "answer-video";
      video.src = questionVideo;
      video.controls = true;
      video.preload = "metadata";
      if (question.question.videoPoster) {
        video.poster = question.question.videoPoster;
      }
      
      videoContainer.appendChild(videoLabel);
      videoContainer.appendChild(video);
      answerContent.appendChild(videoContainer);
      
      const divider = document.createElement("hr");
      divider.className = "answer-divider";
      answerContent.appendChild(divider);
    }

    // Êõ¥Êñ∞ URL hash Áî®‰∫éÂàÜ‰∫´
    const hash = `#${currentModelId}/${question.id}`;
    history.replaceState(null, "", window.location.pathname + hash);

    // ÂàõÂª∫Á≠îÊ°àÂÆπÂô®ÔºàÁî®‰∫éÂ≠òÊîæÊ®°ÂûãÂõûÁ≠îÔºâ
    const answerContainer = document.createElement("div");
    answerContainer.className = "model-answer-container";
    
    // Ê∑ªÂä†Á≠îÊ°àÊ†áÁ≠æ
    const answerLabel = document.createElement("p");
    answerLabel.className = "answer-video-label";
    answerLabel.textContent = "ü§ñ Ê®°ÂûãËæìÂá∫Ôºö";
    answerLabel.style.marginBottom = "0.75rem";
    answerContainer.appendChild(answerLabel);

    if (answer.type === "html") {
      const iframeContainer = document.createElement("div");
      iframeContainer.innerHTML = answer.content;
      answerContainer.appendChild(iframeContainer);
      answerToolbar.style.display = "flex";
    } else if (answer.type === "image") {
      const img = document.createElement("img");
      img.src = answer.content;
      img.alt = answer.alt || I18N.generatedImageAlt;
      img.className = "answer-image";
      answerContainer.appendChild(img);
      answerToolbar.style.display = "none";
    } else {
      const pre = document.createElement("pre");
      pre.className = "answer-text";
      pre.textContent = answer.content;
      answerContainer.appendChild(pre);
      answerToolbar.style.display = "none";
    }
    
    answerContent.appendChild(answerContainer);

    updateNavIndicator();

    answerModal.classList.add("open");
    answerModal.setAttribute("aria-hidden", "false");
  }

  function goToPrevQuestion() {
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      const q = currentFilteredQuestions[currentQuestionIndex];
      openAnswerModal(q);
    }
  }

  function goToNextQuestion() {
    if (currentQuestionIndex < currentFilteredQuestions.length - 1) {
      currentQuestionIndex++;
      const q = currentFilteredQuestions[currentQuestionIndex];
      openAnswerModal(q);
    }
  }

  // ÂØºËà™ÊåâÈíÆ‰∫ã‰ª∂
  if (answerPrev) answerPrev.addEventListener("click", goToPrevQuestion);
  if (answerNext) answerNext.addEventListener("click", goToNextQuestion);

  // ÂÖ®Â±èÂäüËÉΩ
  if (fullscreenBtn) {
    fullscreenBtn.addEventListener("click", () => {
      const iframe = answerContent.querySelector("iframe");
      if (iframe) {
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.webkitRequestFullscreen) {
          iframe.webkitRequestFullscreen();
        } else if (iframe.msRequestFullscreen) {
          iframe.msRequestFullscreen();
        }
      }
    });
  }

  // ÂàÜ‰∫´ÂäüËÉΩ
  if (shareBtn) {
    shareBtn.addEventListener("click", async () => {
      const url = window.location.href;
      try {
        await navigator.clipboard.writeText(url);
        shareBtnText.textContent = "Â∑≤Â§çÂà∂!";
        setTimeout(() => {
          shareBtnText.textContent = "ÂàÜ‰∫´";
        }, 2000);
      } catch (err) {
        // ÈôçÁ∫ßÊñπÊ°à
        const input = document.createElement("input");
        input.value = url;
        document.body.appendChild(input);
        input.select();
        document.execCommand("copy");
        document.body.removeChild(input);
        shareBtnText.textContent = "Â∑≤Â§çÂà∂!";
        setTimeout(() => {
          shareBtnText.textContent = "ÂàÜ‰∫´";
        }, 2000);
      }
    });
  }

  function closeModal(modal) {
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden", "true");
    if (!questionsModal.classList.contains("open") && !answerModal.classList.contains("open")) {
      document.body.style.overflow = "";
      // Ê∏ÖÈô§ hash
      history.replaceState(null, "", window.location.pathname);
    }
  }

  [questionsModal, answerModal].forEach(modal => {
    if (!modal) return;
    modal.querySelectorAll("[data-close]").forEach(el => {
      el.addEventListener("click", () => closeModal(modal));
    });
  });

  document.addEventListener("keydown", e => {
    if (e.key === "Escape") {
      if (answerModal.classList.contains("open")) {
        closeModal(answerModal);
      } else if (questionsModal.classList.contains("open")) {
        closeModal(questionsModal);
      }
    }
    // ‰∏ä‰∏ÄÈ¢ò / ‰∏ã‰∏ÄÈ¢òÂø´Êç∑ÈîÆ
    if (answerModal.classList.contains("open")) {
      if (e.key === "ArrowLeft") {
        goToPrevQuestion();
      } else if (e.key === "ArrowRight") {
        goToNextQuestion();
      }
    }
  });

  // Â§ÑÁêÜ URL hashÔºåÊîØÊåÅÂàÜ‰∫´ÈìæÊé•
  function handleUrlHash() {
    const hash = window.location.hash;
    if (!hash || hash.length < 2) return;

    const parts = hash.slice(1).split("/");
    if (parts.length !== 2) return;

    const [modelId, questionId] = parts;
    const model = allModels.find(m => m.id === modelId);
    if (!model) return;

    const questions = getModelQuestions(modelId);
    const questionIndex = questions.findIndex(q => q.id === questionId);
    if (questionIndex === -1) return;

    // ÊâìÂºÄÂØπÂ∫îÁöÑÊ®°ÊÄÅÊ°Ü
    currentModelId = modelId;
    currentCategory = "all";
    currentFilteredQuestions = questions;
    currentQuestionIndex = questionIndex;

    modalModelName.textContent = `${model.name || I18N.unknownModel} ¬∑ ${I18N.modalQuestionsTitle}`;
    modalModelCompany.textContent = model.company;

    const categories = collectCategories(questions);
    renderQuestionFilters(categories, questions);
    renderQuestionList();

    questionsModal.classList.add("open");
    questionsModal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";

    openAnswerModal(questions[questionIndex]);
  }

  Promise.all([
    fetch(modelsUrl).then(r => r.json()),
    fetch(questionsUrl).then(r => r.json())
  ])
    .then(([models, questions]) => {
      allModels = models || [];
      allQuestions = questions || [];
      filteredModels = allModels;
      renderModels();

      // Â§ÑÁêÜÂàÜ‰∫´ÈìæÊé•
      handleUrlHash();
    })
    .catch(() => setEmpty(true));
})();
</script>

<style>
.eval-shell {
  padding-bottom: 5rem;
}

/* ÊêúÁ¥¢Ê°Ü */
.eval-search-bar {
  margin-bottom: 1.5rem;
}

.eval-search-input {
  width: 100%;
  max-width: 400px;
  padding: 0.75rem 1rem;
  background: var(--surface-highlight);
  border: 1px solid var(--border);
  border-radius: 999px;
  color: var(--text-main);
  font-size: 0.95rem;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.eval-search-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.15);
}

.eval-search-input::placeholder {
  color: var(--text-muted);
}

.eval-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1.25rem;
}

.eval-card {
  background: var(--surface);
  border: 1px solid var(--border);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  transition: transform 0.35s ease, background 0.3s ease, border-color 0.3s ease;
}

.eval-card:hover {
  transform: translateY(-6px);
  background: var(--surface-highlight);
  border-color: rgba(255, 255, 255, 0.12);
}

.eval-card__logo {
  width: 100%;
  height: 140px;
  background: var(--surface-highlight);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  font-weight: 600;
  color: var(--accent);
  border-bottom: 1px solid var(--border);
  overflow: hidden;
}

.eval-card__logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
}

.eval-card__meta {
  flex: 1;
  padding: 0 1.25rem 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.eval-card__company {
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--text-muted);
  margin: 0;
}

.eval-card h3 {
  margin: 0;
  font-family: inherit;
  font-weight: 400;
  font-size: 1.6rem;
}

.eval-card__desc {
  color: var(--text-muted);
  font-size: 0.95rem;
  margin: 0.25rem 0;
  line-height: 1.5;
}

.eval-card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  margin: 0.5rem 0;
}

.eval-card__tags span {
  background: var(--surface-highlight);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 0.2rem 0.7rem;
  font-size: 0.8rem;
}

/* È¢òÁõÆÊï∞ÈáèÊòæÁ§∫ */
.eval-card__count {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.5rem 0;
  margin-top: auto;
}

.eval-card__count .count-number {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--accent);
  font-family: inherit;
}

.eval-card__count .count-label {
  font-size: 0.85rem;
  color: var(--text-muted);
}

.eval-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.5rem 1rem;
  border-radius: 999px;
  border: 1px solid var(--accent);
  color: var(--text-main);
  background: transparent;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background 0.2s ease, color 0.2s ease;
  margin-top: 0.5rem;
  width: fit-content;
}

.eval-btn:hover {
  background: var(--accent);
  color: #000;
}

.eval-btn--sm {
  padding: 0.35rem 0.8rem;
  font-size: 0.85rem;
  margin-top: 0.75rem;
}

.eval-empty {
  margin-top: 2rem;
  text-align: center;
  padding: 2rem;
  border: 1px solid var(--border);
  background: var(--surface-highlight);
  color: var(--text-muted);
}

/* Modal */
.eval-modal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 2000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}

.eval-modal.open {
  opacity: 1;
  pointer-events: auto;
}

.eval-modal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(8px);
}

.eval-modal__dialog {
  position: relative;
  max-width: 680px;
  width: min(92vw, 680px);
  max-height: 85vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  border: 1px solid var(--border);
  background: var(--surface);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.eval-modal__dialog--wide {
  max-width: 1200px;
  width: min(96vw, 1200px);
  height: 85vh;
}

.eval-modal__dialog--wide .eval-modal__body {
  flex: 1;
  overflow-y: auto;
}

.eval-modal__dialog--wide .answer-content iframe {
  height: 70vh !important;
  min-height: 500px;
}

.eval-modal__header {
  padding: 1.5rem 1.5rem 1rem;
  border-bottom: 1px solid var(--border);
  position: relative;
}

.eval-modal__header h2 {
  margin: 0;
  font-family: inherit;
  font-weight: 300;
  font-size: 1.8rem;
  padding-right: 100px;
}

.modal-company {
  color: var(--text-muted);
  font-size: 0.9rem;
  margin: 0.25rem 0 0;
}

.eval-modal__body {
  padding: 1.25rem 1.5rem 1.5rem;
  overflow-y: auto;
  flex: 1;
}

.eval-modal__close {
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  background: var(--surface-highlight);
  color: var(--text-main);
  border: 1px solid var(--border);
  border-radius: 999px;
  width: 36px;
  height: 36px;
  font-size: 1.2rem;
  cursor: pointer;
  z-index: 10;
}

.eval-modal__close:hover {
  color: var(--accent);
}

/* ÂØºËà™ÊåâÈíÆ */
.answer-nav {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background: var(--surface-highlight);
  border-bottom: 1px solid var(--border);
}

.answer-nav__btn {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text-main);
  border-radius: 999px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: all 0.2s ease;
}

.answer-nav__btn:hover:not(:disabled) {
  border-color: var(--accent);
  color: var(--accent);
}

.answer-nav__btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.answer-nav__indicator {
  font-size: 0.9rem;
  color: var(--text-muted);
  min-width: 60px;
  text-align: center;
}

/* ÂàÜ‰∫´ÊåâÈíÆ */
.share-btn {
  position: absolute;
  top: 1.5rem;
  right: 3.5rem;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  background: var(--surface-highlight);
  color: var(--text-muted);
  border-radius: 999px;
  cursor: pointer;
  font-size: 0.8rem;
  transition: all 0.2s ease;
}

.share-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
}

/* Â∑•ÂÖ∑Ê†è */
.answer-toolbar {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 0.75rem;
}

.fullscreen-btn {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  background: var(--surface-highlight);
  color: var(--text-muted);
  border-radius: 999px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: all 0.2s ease;
}

.fullscreen-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
}

/* Question Filters */
.eval-filter-pill {
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text-main);
  padding: 0.35rem 0.85rem;
  border-radius: 999px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

.eval-filter-pill:hover {
  border-color: var(--accent);
}

.eval-filter-pill.active {
  background: var(--accent);
  color: #000;
  border-color: var(--accent);
}

.question-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1.25rem;
}

/* Question List */
.question-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.question-item {
  background: var(--surface-highlight);
  border: 1px solid var(--border);
  padding: 1.25rem;
  transition: border-color 0.2s ease;
}

.question-item:hover {
  border-color: rgba(255, 255, 255, 0.15);
}

.question-item__header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
  margin-bottom: 0.5rem;
}

.question-item h4 {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 500;
}

.question-item__badges {
  display: flex;
  gap: 0.4rem;
  flex-shrink: 0;
}

.badge {
  padding: 0.2rem 0.6rem;
  border-radius: 999px;
  font-size: 0.75rem;
}

.badge--cat {
  background: var(--accent);
  color: #000;
}

.badge--diff {
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text-muted);
}

.question-item__text {
  color: var(--text-muted);
  margin: 0;
  line-height: 1.6;
  font-size: 0.95rem;
}

.no-questions {
  text-align: center;
  color: var(--text-muted);
  padding: 2rem;
}

/* Answer Modal */
.answer-breadcrumb {
  color: var(--text-muted);
  font-size: 0.85rem;
  margin: 0 0 0.25rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.answer-question {
  background: var(--surface-highlight);
  border: 1px solid var(--border);
  padding: 1rem;
  margin-bottom: 1.25rem;
}

.answer-question h4 {
  margin: 0 0 0.5rem;
  font-size: 0.9rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.answer-question p {
  margin: 0;
  line-height: 1.6;
}

.answer-content {
  line-height: 1.7;
}

.answer-content pre,
.answer-text {
  background: var(--surface-highlight);
  border: 1px solid var(--border);
  padding: 1rem;
  white-space: pre-wrap;
  word-break: break-word;
  font-family: inherit;
  font-size: 0.95rem;
  line-height: 1.7;
  margin: 0;
}

.answer-content code {
  font-family: inherit;
}

.answer-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.answer-content th,
.answer-content td {
  border: 1px solid var(--border);
  padding: 0.5rem 0.75rem;
  text-align: left;
}

.answer-content th {
  background: var(--surface-highlight);
}

.answer-image {
  max-width: 100%;
  height: auto;
  border: 1px solid var(--border);
  border-radius: 8px;
}

@media (max-width: 1024px) {
  .eval-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px) {
  .eval-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .answer-nav {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .share-btn {
    position: static;
    margin-top: 0.5rem;
  }

  .eval-modal__header h2 {
    padding-right: 50px;
  }
}

@media (max-width: 480px) {
  .eval-grid {
    grid-template-columns: 1fr;
  }

  .eval-modal__dialog {
    width: 96vw;
    max-height: 90vh;
  }

  .question-item__header {
    flex-direction: column;
    gap: 0.5rem;
  }

  .answer-nav__btn span {
    display: none;
  }
}

/* ËßÜÈ¢ëÈ¢òÁõÆÁõ∏ÂÖ≥Ê†∑Âºè */
.answer-video-container {
  background: var(--surface-highlight);
  border: 1px solid var(--border);
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 8px;
}

.answer-video-label {
  margin: 0 0 0.75rem 0;
  font-size: 0.9rem;
  color: var(--text-muted);
  font-weight: 500;
}

.answer-video {
  width: 100%;
  max-height: 400px;
  border-radius: 8px;
  background: #000;
}

.answer-divider {
  border: none;
  border-top: 1px solid var(--border);
  margin: 1.5rem 0;
}

/* Âê´ËßÜÈ¢ëÊ†áÁ≠æ */
.question-item__badges .badge--video {
  background: #e74c3c;
  color: #fff;
}
</style>
{{ end }}
