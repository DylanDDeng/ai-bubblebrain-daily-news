{{ define "main" }}
{{ $dailyDataFile := resources.Get "daily.json" }}
{{ $dailyData := slice }}
{{ if $dailyDataFile }}
  {{ $dailyData = $dailyDataFile | transform.Unmarshal }}
{{ end }}
<section class="section">
  <div class="section-narrow daily-list-container">
    <header class="page-header">
      <p class="page-eyebrow">{{ i18n "daily_eyebrow" }}</p>
      <h1>{{ .Title }}</h1>
      {{ with .Description }}
        <p class="page-desc">{{ . }}</p>
      {{ end }}
    </header>

    {{ $paginator := .Paginate (.Pages.ByDate.Reverse) 10 }}

    {{ if $paginator.Pages }}
      <div class="daily-grid">
        {{ range $index, $page := $paginator.Pages }}
          {{ $dateId := $page.Date.Format "2006-01-02" }}
          {{ $coverImage := "" }}
          {{ range $dailyData }}
            {{ if eq .id $dateId }}
              {{ $coverImage = .cover }}
            {{ end }}
          {{ end }}
          {{ $coverSmall := $coverImage }}
          {{ $coverLarge := $coverImage }}
          {{ if and $coverImage (or (in $coverImage ".cos.") (in $coverImage "myqcloud.com")) (not (in $coverImage "imageMogr2")) }}
            {{ if not (in $coverImage "?") }}
              {{ $coverSmall = printf "%s?imageMogr2/format/webp/thumbnail/480x/quality/85" $coverImage }}
              {{ $coverLarge = printf "%s?imageMogr2/format/webp/thumbnail/960x/quality/85" $coverImage }}
            {{ end }}
          {{ end }}
          <article class="daily-card reveal-text{{ if lt $index 6 }} active{{ end }}">
            {{ if $coverImage }}
            <div class="card-cover">
              <img
                src="{{ $coverSmall }}"
                srcset="{{ $coverSmall }} 480w, {{ $coverLarge }} 960w"
                sizes="(max-width: 768px) 100vw, 480px"
                alt="{{ $page.Title }}"
                decoding="async"
                {{ if eq $index 0 }}fetchpriority="high"{{ else }}loading="lazy"{{ end }}
              >
            </div>
            {{ end }}
            <div class="card-header">
              <h2>
                <a href="{{ $page.Permalink }}">{{ $page.Title }}</a>
              </h2>
              <time datetime="{{ $page.Date.Format "2006-01-02" }}">
                {{ $page.Date.Format (i18n "date_format") }}
              </time>
            </div>
            
            <div class="card-content">
              {{ with $page.Description }}
                <p>{{ . }}</p>
              {{ else }}
                <p>{{ $page.Summary | truncate 200 }}</p>
              {{ end }}
            </div>
            
            <div class="card-footer">
              <a href="{{ $page.Permalink }}" class="read-more">
                {{ i18n "daily_read_more" }}
              </a>
            </div>
          </article>
        {{ end }}
      </div>

      {{ if gt $paginator.TotalPages 1 }}
        <nav class="pagination" aria-label="{{ i18n "daily_pagination_aria" }}">
          {{ if $paginator.HasPrev }}
            <a class="pagination-link" href="{{ $paginator.Prev.URL }}">{{ i18n "pagination_prev" }}</a>
          {{ else }}
            <span class="pagination-link disabled">{{ i18n "pagination_prev" }}</span>
          {{ end }}

          <div class="pagination-pages">
            {{ range $pager := $paginator.Pagers }}
              {{ if eq $pager.PageNumber $paginator.PageNumber }}
                <span class="pagination-page current">{{ $pager.PageNumber }}</span>
              {{ else }}
                <a class="pagination-page" href="{{ $pager.URL }}">{{ $pager.PageNumber }}</a>
              {{ end }}
            {{ end }}
          </div>

          {{ if $paginator.HasNext }}
            <a class="pagination-link" href="{{ $paginator.Next.URL }}">{{ i18n "pagination_next" }}</a>
          {{ else }}
            <span class="pagination-link disabled">{{ i18n "pagination_next" }}</span>
          {{ end }}
        </nav>
      {{ end }}
    {{ else }}
      <div class="empty-state">
        <p>{{ i18n "daily_empty_title" }}</p>
        <p>{{ i18n "daily_empty_hint" }}</p>
      </div>
    {{ end }}
  </div>
</section>

{{ end }}
