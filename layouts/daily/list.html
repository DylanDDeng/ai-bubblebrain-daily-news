{{ define "main" }}
{{ $dailyDataFile := resources.Get "daily.json" }}
{{ $dailyData := slice }}
{{ if $dailyDataFile }}
  {{ $dailyData = $dailyDataFile | transform.Unmarshal }}
{{ end }}
<section class="section">
  <div class="section-narrow daily-list-container">
    <header class="page-header">
      <p class="page-eyebrow">{{ i18n "daily_eyebrow" }}</p>
      <h1>{{ .Title }}</h1>
      {{ with .Description }}
        <p class="page-desc">{{ . }}</p>
      {{ end }}
    </header>

    {{ $paginator := .Paginate (.Pages.ByDate.Reverse) 10 }}

    {{ if $paginator.Pages }}
      <div class="daily-grid">
        {{ range $paginator.Pages }}
          {{ $dateId := .Date.Format "2006-01-02" }}
          {{ $coverImage := "" }}
          {{ range $dailyData }}
            {{ if eq .id $dateId }}
              {{ $coverImage = .cover }}
            {{ end }}
          {{ end }}
          <article class="daily-card reveal-text">
            {{ if $coverImage }}
            <div class="card-cover">
              <img src="{{ $coverImage }}" alt="{{ .Title }}">
            </div>
            {{ end }}
            <div class="card-header">
              <h2>
                <a href="{{ .Permalink }}">{{ .Title }}</a>
              </h2>
              <time datetime="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format (i18n "date_format") }}
              </time>
            </div>
            
            <div class="card-content">
              {{ with .Description }}
                <p>{{ . }}</p>
              {{ else }}
                <p>{{ .Summary | truncate 200 }}</p>
              {{ end }}
            </div>
            
            <div class="card-footer">
              <a href="{{ .Permalink }}" class="read-more">
                {{ i18n "daily_read_more" }}
              </a>
            </div>
          </article>
        {{ end }}
      </div>

      {{ if gt $paginator.TotalPages 1 }}
        <nav class="pagination" aria-label="{{ i18n "daily_pagination_aria" }}">
          {{ if $paginator.HasPrev }}
            <a class="pagination-link" href="{{ $paginator.Prev.URL }}">{{ i18n "pagination_prev" }}</a>
          {{ else }}
            <span class="pagination-link disabled">{{ i18n "pagination_prev" }}</span>
          {{ end }}

          <div class="pagination-pages">
            {{ range $pager := $paginator.Pagers }}
              {{ if eq $pager.PageNumber $paginator.PageNumber }}
                <span class="pagination-page current">{{ $pager.PageNumber }}</span>
              {{ else }}
                <a class="pagination-page" href="{{ $pager.URL }}">{{ $pager.PageNumber }}</a>
              {{ end }}
            {{ end }}
          </div>

          {{ if $paginator.HasNext }}
            <a class="pagination-link" href="{{ $paginator.Next.URL }}">{{ i18n "pagination_next" }}</a>
          {{ else }}
            <span class="pagination-link disabled">{{ i18n "pagination_next" }}</span>
          {{ end }}
        </nav>
      {{ end }}
    {{ else }}
      <div class="empty-state">
        <p>{{ i18n "daily_empty_title" }}</p>
        <p>{{ i18n "daily_empty_hint" }}</p>
      </div>
    {{ end }}
  </div>
</section>

{{ partial "daily-section-styles.html" . }}
{{ end }}
